import{e as j,r as n,w as F,c as _,f as q,h as d,g as w,a as r,t as U,b as a,_ as z,s as A,E as T,d as v,j as $,k,L as Y,v as H,m as J,p as K,n as O,z as Q,q as W}from"./index-B2XI_na9.js";import{E as X,a as Z}from"./el-progress-CpYr7feg.js";import{E as s,a as ee}from"./el-scrollbar-BKdTLTRc.js";const le={class:"container mx-auto flex flex-col items-center max-h-screen p-4 space-y-4"},te={key:1,class:"space-y-4"},ae={class:"text-center mb-4"},se={class:"text-gray-600"},oe={key:0,class:"upload-trigger"},ne={key:1,class:"upload-trigger"},re=["src"],ue={class:"el-upload-list__item-actions"},ie=["onClick"],ce=["onClick"],de={key:2,class:"flex justify-center my-6"},ve={key:3,class:"flex items-center justify-center w-full"},pe={key:0},_e={key:1,class:"text-center text-gray-500"},me=["src"],fe={__name:"MonthlyForecastPredictView",setup(ge){const p=n(null),h=n([]),m=n(!1),t=n([]),V=n(""),x=n(!1),f=n([]),u=n(!1),y=n(null),g=n(null);F(t,e=>{e.length===12&&s.success("已成功选择12张图片")});const b=e=>new Promise((l,o)=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>l(i.result),i.onerror=P=>o(P)}),B=e=>e.type==="image/png"?t.value.length>=12?(s.error("已达到12张图片上限"),!1):!0:(s.error("仅支持PNG文件"),!1),C=(e,l)=>{const o=e.image_url;o&&f.value.push(o),s.success(`${l.name} 上传成功`)},N=(e,l)=>{s.error(`${l.name} 上传失败`),console.error("Upload error:",e)},I=async e=>{!e.url&&!e.preview&&(e.preview=await b(e.raw)),V.value=e.url||e.preview,x.value=!0},E=e=>{t.value=t.value.filter(o=>o.uid!==e.uid);const l=t.value.findIndex(o=>o.uid===e.uid);l!==-1&&f.value.splice(l,1),s.warning(`还需上传${12-t.value.length}张图片`)},D=async()=>{if(y.value)try{const e=await H(y.value);e.length!=0?(h.value=e,m.value=!0,clearInterval(g.value),u.value=!1):(clearInterval(g.value),u.value=!1,s.error("预测失败，请稍后重试"))}catch(e){clearInterval(g.value),u.value=!1,s.error("获取预测结果失败，请稍后重试"),console.error(e)}},R=async()=>{if(!p.value){s.error("请选择日期");return}if(t.value.length!==12){s.error(`请上传正好12张图片, 当前已上传${t.value.length}张`);return}if(f.value.length!==12){s.error("部分图片上传未完成，请等待所有图片上传完成后重试");return}try{u.value=!0;const e=`${p.value.getFullYear()}/${(p.value.getMonth()+1).toString().padStart(2,"0")}/${p.value.getDate().toString().padStart(2,"0")}`,l=await A(e,f.value);y.value=l.task_id,g.value=setInterval(D,2e3)}catch(e){m.value=!1,s.error("提交预测请求失败，请稍后重试"),console.error(e),u.value=!1}},L=()=>{m.value=!1,h.value=[],y.value=null,g.value&&clearInterval(g.value),t.value=[],f.value=[],p.value=null};return(e,l)=>{const o=T,i=J,P=X,M=ee,S=Z;return v(),_("div",le,[m.value?(v(),q(o,{key:0,class:"self-start",onClick:L},{default:d(()=>l[3]||(l[3]=[$(" 返回 ")])),_:1})):w("",!0),m.value?w("",!0):(v(),_("div",te,[r("div",ae,[r("p",se,"请上传正好12张PNG图片 (已上传: "+U(t.value.length)+"/12)",1)]),a(P,{"file-list":t.value,"onUpdate:fileList":l[0]||(l[0]=c=>t.value=c),class:"upload-demo",action:"https://seaice.52lxy.one:20443/seaice/png-upload",accept:".png","list-type":"picture-card",multiple:!0,limit:12,"before-upload":B,"on-preview":I,"on-success":C,"on-error":N,"on-remove":E,"auto-upload":!0},{default:d(()=>[t.value.length<12?(v(),_("div",oe,[a(i,{class:"upload-icon"},{default:d(()=>[a(k(K))]),_:1}),l[4]||(l[4]=r("div",{class:"upload-text"},"上传",-1))])):(v(),_("div",ne,[a(i,{class:"upload-icon text-green-500"},{default:d(()=>[a(k(O))]),_:1}),l[5]||(l[5]=r("div",{class:"upload-text text-green-500"},"已完成",-1))]))]),file:d(({file:c})=>[r("div",null,[r("img",{class:"el-upload-list__item-thumbnail",src:c.url,alt:""},null,8,re),r("span",ue,[r("span",{class:"el-upload-list__item-preview",onClick:G=>I(c)},[a(i,null,{default:d(()=>[a(k(Q))]),_:1})],8,ie),r("span",{class:"el-upload-list__item-delete",onClick:G=>E(c)},[a(i,null,{default:d(()=>[a(k(W))]),_:1})],8,ce)])])]),_:1},8,["file-list"]),a(M,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=c=>p.value=c),type:"month",placeholder:"请选择月份",style:{width:"100%","max-width":"300px"}},null,8,["modelValue"]),a(o,{type:"primary",onClick:R,loading:u.value,disabled:t.value.length!==12||!p.value||f.value.length!==12},{default:d(()=>[$(U(u.value?"分析中...":"提交分析"),1)]),_:1},8,["loading","disabled"])])),u.value?(v(),_("div",de,[a(Y)])):w("",!0),!u.value&&m.value?(v(),_("div",ve,[h.value.length?(v(),_("div",pe,[a(z,{images:h.value},null,8,["images"])])):(v(),_("div",_e,"请上传图片并选择日期以查看预测结果"))])):w("",!0),a(S,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=c=>x.value=c),title:"预览"},{default:d(()=>[r("img",{"w-full":"",src:V.value,alt:"Preview Image"},null,8,me)]),_:1},8,["modelValue"])])}}},ke=j(fe,[["__scopeId","data-v-ee5223af"]]);export{ke as default};
