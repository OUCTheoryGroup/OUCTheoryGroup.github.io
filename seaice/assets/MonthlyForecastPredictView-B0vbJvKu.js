import{e as I,r as p,w as M,c as _,f as R,h as i,g as x,a as o,t as G,b as a,_ as F,q as L,E as j,d as c,j as V,k as g,l as q,p as z,m as T,z as A,n as Y}from"./index-D_tsbBA3.js";import{E as n,a as H,b as J}from"./el-progress-Dw4ihrSw.js";import{E as K}from"./el-scrollbar-C5Z6xj_Y.js";const O={class:"container mx-auto flex flex-col items-center max-h-screen p-4 space-y-4"},Q={key:1,class:"space-y-4"},W={class:"text-center mb-4"},X={class:"text-gray-600"},Z={key:0,class:"upload-trigger"},ee={key:1,class:"upload-trigger"},te=["src"],le={class:"el-upload-list__item-actions"},ae=["onClick"],se=["onClick"],oe={key:2,class:"flex items-center justify-center w-full"},ne={key:0},re={key:1,class:"text-center text-gray-500"},ue=["src"],ie={__name:"MonthlyForecastPredictView",setup(de){const d=p(null),f=p([]),m=p(!1),l=p([]),y=p(""),h=p(!1),v=p([]);M(l,t=>{t.length===12&&n.success("已成功选择12张图片")});const E=t=>new Promise((e,s)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(r.result),r.onerror=w=>s(w)}),b=t=>t.type==="image/png"?l.value.length>=12?(n.error("已达到12张图片上限"),!1):!0:(n.error("仅支持PNG文件"),!1),U=(t,e)=>{const s=t.image_url;s&&v.value.push(s),n.success(`${e.name} 上传成功`)},$=(t,e)=>{n.error(`${e.name} 上传失败`),console.error("Upload error:",t)},k=async t=>{!t.url&&!t.preview&&(t.preview=await E(t.raw)),y.value=t.url||t.preview,h.value=!0},P=t=>{l.value=l.value.filter(s=>s.uid!==t.uid);const e=l.value.findIndex(s=>s.uid===t.uid);e!==-1&&v.value.splice(e,1),n.warning(`还需上传${12-l.value.length}张图片`)},B=()=>{if(!d.value){n.error("请选择日期");return}if(l.value.length!==12){n.error(`请上传正好12张图片，当前已上传${l.value.length}张`);return}if(v.value.length!==12){n.error("部分图片上传未完成，请等待所有图片上传完成后重试");return}const t=`${d.value.getFullYear()}/${(d.value.getMonth()+1).toString().padStart(2,"0")}/${d.value.getDate().toString().padStart(2,"0")}`;L(t,v.value).then(e=>{f.value=e,m.value=!0}).catch(e=>{n.error("预测失败，请稍后重试"),console.error(e)})},C=()=>{m.value=!1,f.value=[],d.value=null,l.value=[],v.value=[]};return(t,e)=>{const s=j,r=q,w=H,N=K,D=J;return c(),_("div",O,[m.value?(c(),R(s,{key:0,class:"self-start",onClick:C},{default:i(()=>e[3]||(e[3]=[V(" 返回 ")])),_:1})):x("",!0),m.value?x("",!0):(c(),_("div",Q,[o("div",W,[o("p",X,"请上传正好12张PNG图片 (已上传: "+G(l.value.length)+"/12)",1)]),a(w,{"file-list":l.value,"onUpdate:fileList":e[0]||(e[0]=u=>l.value=u),class:"upload-demo",action:"https://seaice.52lxy.one:20443/seaice/png-upload",accept:".png","list-type":"picture-card",multiple:!0,limit:12,"before-upload":b,"on-preview":k,"on-success":U,"on-error":$,"on-remove":P,"auto-upload":!0},{default:i(()=>[l.value.length<12?(c(),_("div",Z,[a(r,{class:"upload-icon"},{default:i(()=>[a(g(z))]),_:1}),e[4]||(e[4]=o("div",{class:"upload-text"},"上传",-1))])):(c(),_("div",ee,[a(r,{class:"upload-icon text-green-500"},{default:i(()=>[a(g(T))]),_:1}),e[5]||(e[5]=o("div",{class:"upload-text text-green-500"},"已完成",-1))]))]),file:i(({file:u})=>[o("div",null,[o("img",{class:"el-upload-list__item-thumbnail",src:u.url,alt:""},null,8,te),o("span",le,[o("span",{class:"el-upload-list__item-preview",onClick:S=>k(u)},[a(r,null,{default:i(()=>[a(g(A))]),_:1})],8,ae),o("span",{class:"el-upload-list__item-delete",onClick:S=>P(u)},[a(r,null,{default:i(()=>[a(g(Y))]),_:1})],8,se)])])]),_:1},8,["file-list"]),a(N,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=u=>d.value=u),type:"month",placeholder:"请选择月份",style:{width:"100%","max-width":"300px"}},null,8,["modelValue"]),a(s,{type:"primary",onClick:B,disabled:l.value.length!==12||!d.value||v.value.length!==12},{default:i(()=>e[6]||(e[6]=[V(" 提交 ")])),_:1},8,["disabled"])])),m.value?(c(),_("div",oe,[f.value.length?(c(),_("div",ne,[a(F,{images:f.value},null,8,["images"])])):(c(),_("div",re,"请上传图片并选择日期以查看预测结果"))])):x("",!0),a(D,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=u=>h.value=u),title:"预览"},{default:i(()=>[o("img",{"w-full":"",src:y.value,alt:"Preview Image"},null,8,ue)]),_:1},8,["modelValue"])])}}},ve=I(ie,[["__scopeId","data-v-7ed4d4ff"]]);export{ve as default};
