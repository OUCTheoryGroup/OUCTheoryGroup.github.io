import{e as j,r as n,w as q,c as p,f as z,g as w,a as r,t as E,b as t,h as d,_ as A,i as F,E as S,d as v,j as b,k,L as T,l as H,m as J,p as K,n as O,z as Q,q as W}from"./index-B2XI_na9.js";import{E as X,a as Z}from"./el-progress-CpYr7feg.js";import{E as s,a as ee}from"./el-scrollbar-BKdTLTRc.js";const le={class:"container mx-auto flex flex-col items-center max-h-screen p-4 space-y-4"},ae={key:1,class:"space-y-4"},te={class:"text-center mb-4"},se={class:"text-gray-600"},oe={key:0,class:"upload-trigger"},ne={key:1,class:"upload-trigger"},re=["src"],ue={class:"el-upload-list__item-actions"},ie=["onClick"],ce=["onClick"],de={key:2,class:"flex justify-center my-6"},ve={key:3,class:"flex items-center justify-center w-full"},pe={key:0},_e={key:1,class:"text-center text-gray-500"},me=["src"],fe={__name:"DailyForecastPredictView",setup(ge){const _=n(null),h=n([]),m=n(!1),a=n([]),D=n(""),x=n(!1),f=n([]),u=n(!1),y=n(null),g=n(null);q(a,e=>{e.length===14&&s.success("已成功选择14张图片")});const U=e=>new Promise((l,o)=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>l(i.result),i.onerror=P=>o(P)}),B=e=>e.type==="image/png"?a.value.length>=14?(s.error("已达到14张图片上限"),!1):!0:(s.error("仅支持PNG文件"),!1),C=(e,l)=>{const o=e.image_url;o&&f.value.push(o),s.success(`${l.name} 上传成功`)},N=(e,l)=>{s.error(`${l.name} 上传失败`),console.error("Upload error:",e)},V=async e=>{!e.url&&!e.preview&&(e.preview=await U(e.raw)),D.value=e.url||e.preview,x.value=!0},I=e=>{a.value=a.value.filter(o=>o.uid!==e.uid);const l=a.value.findIndex(o=>o.uid===e.uid);l!==-1&&f.value.splice(l,1),s.warning(`还需上传${14-a.value.length}张图片`)},Y=async()=>{if(y.value)try{const e=await H(y.value);e.length!=0?(h.value=e,m.value=!0,clearInterval(g.value),u.value=!1):(clearInterval(g.value),u.value=!1,s.error("预测失败，请稍后重试"))}catch(e){clearInterval(g.value),u.value=!1,s.error("获取预测结果失败，请稍后重试"),console.error(e)}},R=async()=>{if(!_.value){s.error("请选择日期");return}if(a.value.length!==14){s.error(`请上传正好14张图片, 当前已上传${a.value.length}张`);return}if(f.value.length!==14){s.error("部分图片上传未完成，请等待所有图片上传完成后重试");return}try{u.value=!0;const e=await F(_.value,f.value);y.value=e.task_id,g.value=setInterval(Y,2e3)}catch(e){m.value=!1,s.error("提交预测请求失败，请稍后重试"),console.error(e),u.value=!1}},$=()=>{m.value=!1,h.value=[],y.value=null,g.value&&clearInterval(g.value),a.value=[],f.value=[],_.value=null};return(e,l)=>{const o=S,i=J,P=X,L=ee,M=Z;return v(),p("div",le,[m.value?(v(),z(o,{key:0,class:"self-start",onClick:$},{default:d(()=>l[3]||(l[3]=[b(" 返回 ")])),_:1})):w("",!0),m.value?w("",!0):(v(),p("div",ae,[r("div",te,[r("p",se,"请上传正好14张PNG图片 (已上传: "+E(a.value.length)+"/14)",1)]),t(P,{"file-list":a.value,"onUpdate:fileList":l[0]||(l[0]=c=>a.value=c),class:"upload-demo",action:"https://seaice.52lxy.one:20443/seaice/png-upload",accept:".png","list-type":"picture-card",multiple:!0,limit:14,"before-upload":B,"on-preview":V,"on-success":C,"on-error":N,"on-remove":I,"auto-upload":!0},{default:d(()=>[a.value.length<14?(v(),p("div",oe,[t(i,{class:"upload-icon"},{default:d(()=>[t(k(K))]),_:1}),l[4]||(l[4]=r("div",{class:"upload-text"},"上传",-1))])):(v(),p("div",ne,[t(i,{class:"upload-icon text-green-500"},{default:d(()=>[t(k(O))]),_:1}),l[5]||(l[5]=r("div",{class:"upload-text text-green-500"},"已完成",-1))]))]),file:d(({file:c})=>[r("div",null,[r("img",{class:"el-upload-list__item-thumbnail",src:c.url,alt:""},null,8,re),r("span",ue,[r("span",{class:"el-upload-list__item-preview",onClick:G=>V(c)},[t(i,null,{default:d(()=>[t(k(Q))]),_:1})],8,ie),r("span",{class:"el-upload-list__item-delete",onClick:G=>I(c)},[t(i,null,{default:d(()=>[t(k(W))]),_:1})],8,ce)])])]),_:1},8,["file-list"]),t(L,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=c=>_.value=c),type:"date",placeholder:"选择日期",format:"YYYY/MM/DD",style:{width:"100%","max-width":"300px"},"value-format":"YYYY/MM/DD"},null,8,["modelValue"]),t(o,{type:"primary",onClick:R,loading:u.value,disabled:a.value.length!==14||!_.value||f.value.length!==14},{default:d(()=>[b(E(u.value?"分析中...":"提交分析"),1)]),_:1},8,["loading","disabled"])])),u.value?(v(),p("div",de,[t(T)])):w("",!0),!u.value&&m.value?(v(),p("div",ve,[h.value.length?(v(),p("div",pe,[t(A,{images:h.value},null,8,["images"])])):(v(),p("div",_e,"请上传图片并选择日期以查看预测结果"))])):w("",!0),t(M,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=c=>x.value=c),title:"预览"},{default:d(()=>[r("img",{"w-full":"",src:D.value,alt:"Preview Image"},null,8,me)]),_:1},8,["modelValue"])])}}},ke=j(fe,[["__scopeId","data-v-65665fb3"]]);export{ke as default};
