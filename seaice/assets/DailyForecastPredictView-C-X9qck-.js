import{e as j,r as n,w as T,c as p,f as q,g as k,a as r,t as I,b as a,h as c,_ as z,i as A,E as F,d,j as U,k as w,L as S,l as H,m as J,p as K,n as O,z as Q,q as W}from"./index-5jUxxsCX.js";import{E as X,a as Z}from"./el-progress-D_OaJF_r.js";import{E as o,a as ee}from"./el-scrollbar-x_x3g53E.js";const le={class:"container mx-auto flex flex-col items-center max-h-screen p-4 space-y-4"},te={key:1,class:"space-y-4"},ae={class:"text-center mb-4"},se={class:"text-gray-600"},oe={key:0,class:"upload-trigger"},ne={key:1,class:"upload-trigger"},re=["src"],ue={class:"el-upload-list__item-actions"},ie=["onClick"],ce=["onClick"],de={key:2,class:"flex justify-center my-6"},ve={key:3,class:"flex items-center justify-center w-full"},pe={key:0},_e={key:1,class:"text-center text-gray-500"},me=["src"],fe={__name:"DailyForecastPredictView",setup(ge){const _=n(null),h=n([]),m=n(!1),t=n([]),D=n(""),x=n(!1),f=n([]),v=n(!1),y=n(null),g=n(null);T(t,e=>{e.length===14&&o.success("已成功选择14张图片")});const b=e=>new Promise((l,s)=>{const u=new FileReader;u.readAsDataURL(e),u.onload=()=>l(u.result),u.onerror=P=>s(P)}),B=e=>e.type==="image/png"?t.value.length>=14?(o.error("已达到14张图片上限"),!1):!0:(o.error("仅支持PNG文件"),!1),C=(e,l)=>{const s=e.image_url;s&&f.value.push(s),o.success(`${l.name} 上传成功`)},N=(e,l)=>{o.error(`${l.name} 上传失败`),console.error("Upload error:",e)},V=async e=>{!e.url&&!e.preview&&(e.preview=await b(e.raw)),D.value=e.url||e.preview,x.value=!0},E=e=>{t.value=t.value.filter(s=>s.uid!==e.uid);const l=t.value.findIndex(s=>s.uid===e.uid);l!==-1&&f.value.splice(l,1),o.warning(`还需上传${14-t.value.length}张图片`)},Y=async()=>{if(y.value)try{const e=await H(y.value);e.length!=0&&(h.value=e,m.value=!0,clearInterval(g.value),v.value=!1)}catch(e){if(e.response&&e.response.status===400){console.log("Task not completed yet, continuing polling...");return}clearInterval(g.value),v.value=!1,o.error("获取预测结果失败，请稍后重试"),console.error(e)}},R=async()=>{if(!_.value){o.error("请选择日期");return}if(t.value.length!==14){o.error(`请上传正好14张图片, 当前已上传${t.value.length}张`);return}if(f.value.length!==14){o.error("部分图片上传未完成，请等待所有图片上传完成后重试");return}try{v.value=!0;const e=await A(_.value,f.value);y.value=e.task_id,g.value=setInterval(Y,2e3)}catch(e){m.value=!1,o.error("提交预测请求失败，请稍后重试"),console.error(e),v.value=!1}},$=()=>{m.value=!1,h.value=[],y.value=null,g.value&&clearInterval(g.value),t.value=[],f.value=[],_.value=null};return(e,l)=>{const s=F,u=J,P=X,L=ee,M=Z;return d(),p("div",le,[m.value?(d(),q(s,{key:0,class:"self-start",onClick:$},{default:c(()=>l[3]||(l[3]=[U(" 返回 ")])),_:1})):k("",!0),m.value?k("",!0):(d(),p("div",te,[r("div",ae,[r("p",se,"请上传正好14张PNG图片 (已上传: "+I(t.value.length)+"/14)",1)]),a(P,{"file-list":t.value,"onUpdate:fileList":l[0]||(l[0]=i=>t.value=i),class:"upload-demo",action:"https://seaice.52lxy.one:20443/seaice/png-upload",accept:".png","list-type":"picture-card",multiple:!0,limit:14,"before-upload":B,"on-preview":V,"on-success":C,"on-error":N,"on-remove":E,"auto-upload":!0},{default:c(()=>[t.value.length<14?(d(),p("div",oe,[a(u,{class:"upload-icon"},{default:c(()=>[a(w(K))]),_:1}),l[4]||(l[4]=r("div",{class:"upload-text"},"上传",-1))])):(d(),p("div",ne,[a(u,{class:"upload-icon text-green-500"},{default:c(()=>[a(w(O))]),_:1}),l[5]||(l[5]=r("div",{class:"upload-text text-green-500"},"已完成",-1))]))]),file:c(({file:i})=>[r("div",null,[r("img",{class:"el-upload-list__item-thumbnail",src:i.url,alt:""},null,8,re),r("span",ue,[r("span",{class:"el-upload-list__item-preview",onClick:G=>V(i)},[a(u,null,{default:c(()=>[a(w(Q))]),_:1})],8,ie),r("span",{class:"el-upload-list__item-delete",onClick:G=>E(i)},[a(u,null,{default:c(()=>[a(w(W))]),_:1})],8,ce)])])]),_:1},8,["file-list"]),a(L,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=i=>_.value=i),type:"date",placeholder:"选择日期",format:"YYYY/MM/DD",style:{width:"100%","max-width":"300px"},"value-format":"YYYY/MM/DD"},null,8,["modelValue"]),a(s,{type:"primary",onClick:R,loading:v.value,disabled:t.value.length!==14||!_.value||f.value.length!==14},{default:c(()=>[U(I(v.value?"分析中...":"提交分析"),1)]),_:1},8,["loading","disabled"])])),v.value?(d(),p("div",de,[a(S)])):k("",!0),!v.value&&m.value?(d(),p("div",ve,[h.value.length?(d(),p("div",pe,[a(z,{images:h.value},null,8,["images"])])):(d(),p("div",_e,"请上传图片并选择日期以查看预测结果"))])):k("",!0),a(M,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=i=>x.value=i),title:"预览"},{default:c(()=>[r("img",{"w-full":"",src:D.value,alt:"Preview Image"},null,8,me)]),_:1},8,["modelValue"])])}}},we=j(fe,[["__scopeId","data-v-c8c04996"]]);export{we as default};
