import{j as o,d as I,k as M,l as G,m as L,E as R}from"./element-plus-C_c9kMY5.js";import{q as S,t as j,z,x as F}from"./@element-plus-W9iT9tjK.js";import{_ as T}from"./index-Bu0mnn7G.js";import{_ as q,u as A}from"./plugin-vueexport-helper-ffJgro2v.js";import{r as d,w as Q,c as p,Q as H,V as x,a as r,U as J,L as a,P as u,o as c,T as V,u as g}from"./@vue-BNSRWWJn.js";import"./lodash-es-QeLhLsho.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-Bd7NwZzn.js";import"./dayjs-CdCgAjqw.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./vue-router-BYwqdpxB.js";import"./axios-CCb-kr4I.js";const K={class:"container mx-auto flex flex-col items-center max-h-screen p-4 space-y-4"},O={key:1,class:"space-y-4"},W={class:"text-center mb-4"},X={class:"text-gray-600"},Z={key:0,class:"upload-trigger"},ee={key:1,class:"upload-trigger"},te=["src"],le={class:"el-upload-list__item-actions"},ae=["onClick"],se=["onClick"],oe={key:2,class:"flex items-center justify-center w-full"},re={key:0},ne={key:1,class:"text-center text-gray-500"},ie=["src"],ue={__name:"DailyForecastPredictView",setup(ce){const m=d(null),f=d([]),v=d(!1),l=d([]),k=d(""),h=d(!1),_=d([]);Q(l,e=>{e.length===14&&o.success("已成功选择14张图片")});const D=e=>new Promise((t,s)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=y=>s(y)}),U=e=>e.type==="image/png"?l.value.length>=14?(o.error("已达到14张图片上限"),!1):!0:(o.error("仅支持PNG文件"),!1),E=(e,t)=>{const s=e.image_url;s&&_.value.push(s),o.success(`${t.name} 上传成功`)},b=(e,t)=>{o.error(`${t.name} 上传失败`),console.error("Upload error:",e)},w=async e=>{!e.url&&!e.preview&&(e.preview=await D(e.raw)),k.value=e.url||e.preview,h.value=!0},P=e=>{l.value=l.value.filter(s=>s.uid!==e.uid);const t=l.value.findIndex(s=>s.uid===e.uid);t!==-1&&_.value.splice(t,1),o.warning(`还需上传${14-l.value.length}张图片`)},B=()=>{if(!m.value){o.error("请选择日期");return}if(l.value.length!==14){o.error(`请上传exactly 14张图片，当前已上传${l.value.length}张`);return}if(_.value.length!==14){o.error("部分图片上传未完成，请等待所有图片上传完成后重试");return}A(m.value,_.value).then(e=>{f.value=e,v.value=!0}).catch(e=>{o.error("预测失败，请稍后重试"),console.error(e)})},C=()=>{v.value=!1,f.value=[],m.value=null,l.value=[],_.value=[]};return(e,t)=>{const s=I,n=R,y=M,N=G,Y=L;return c(),p("div",K,[v.value?(c(),H(s,{key:0,class:"self-start",onClick:C},{default:u(()=>t[3]||(t[3]=[V(" 返回 ")])),_:1})):x("",!0),v.value?x("",!0):(c(),p("div",O,[r("div",W,[r("p",X,"请上传exactly 14张PNG图片 (已上传: "+J(l.value.length)+"/14)",1)]),a(y,{"file-list":l.value,"onUpdate:fileList":t[0]||(t[0]=i=>l.value=i),class:"upload-demo",action:"https://seaice.52lxy.one:20443/seaice/png-upload",accept:".png","list-type":"picture-card",multiple:!0,limit:14,"before-upload":U,"on-preview":w,"on-success":E,"on-error":b,"on-remove":P,"auto-upload":!0},{default:u(()=>[l.value.length<14?(c(),p("div",Z,[a(n,{class:"upload-icon"},{default:u(()=>[a(g(S))]),_:1}),t[4]||(t[4]=r("div",{class:"upload-text"},"Upload",-1))])):(c(),p("div",ee,[a(n,{class:"upload-icon text-green-500"},{default:u(()=>[a(g(j))]),_:1}),t[5]||(t[5]=r("div",{class:"upload-text text-green-500"},"已完成",-1))]))]),file:u(({file:i})=>[r("div",null,[r("img",{class:"el-upload-list__item-thumbnail",src:i.url,alt:""},null,8,te),r("span",le,[r("span",{class:"el-upload-list__item-preview",onClick:$=>w(i)},[a(n,null,{default:u(()=>[a(g(z))]),_:1})],8,ae),r("span",{class:"el-upload-list__item-delete",onClick:$=>P(i)},[a(n,null,{default:u(()=>[a(g(F))]),_:1})],8,se)])])]),_:1},8,["file-list"]),a(N,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=i=>m.value=i),type:"date",placeholder:"选择日期",format:"YYYY/MM/DD","value-format":"YYYY/MM/DD"},null,8,["modelValue"]),a(s,{type:"primary",onClick:B,disabled:l.value.length!==14||!m.value||_.value.length!==14},{default:u(()=>t[6]||(t[6]=[V(" 提交 ")])),_:1},8,["disabled"])])),v.value?(c(),p("div",oe,[f.value.length?(c(),p("div",re,[a(T,{images:f.value},null,8,["images"])])):(c(),p("div",ne,"请上传图片并选择日期以查看预测结果"))])):x("",!0),a(Y,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=i=>h.value=i),title:"预览"},{default:u(()=>[r("img",{"w-full":"",src:k.value,alt:"Preview Image"},null,8,ie)]),_:1},8,["modelValue"])])}}},Ve=q(ue,[["__scopeId","data-v-e306d77e"]]);export{Ve as default};
